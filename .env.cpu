# ============================================================================
# Tianshu (天枢) - CPU 本地开发环境配置
# ============================================================================
#
# 使用方式：
#   1. 此文件专为 Mac Apple Silicon (M1/M2/M3/M4) CPU 开发环境设计
#   2. 使用 docker-compose -f docker-compose.cpu.yml --env-file .env.cpu up -d 启动
#   3. 或使用脚本: bash scripts/start-local-cpu.sh
#
# 重要说明:
#   - CPU 模式适合本地开发调试，不适合生产环境
#   - 性能比 GPU 慢 10-20 倍
#   - 使用 Rosetta 2 模拟 x86_64/amd64
#
# ============================================================================

# ----------------------------------------------------------------------------
# 应用配置
# ----------------------------------------------------------------------------
API_PORT=8000
WORKER_PORT=8001
MCP_PORT=8002
FRONTEND_PORT=80

LOG_LEVEL=INFO

# ----------------------------------------------------------------------------
# JWT 认证配置
# ----------------------------------------------------------------------------
# 重要：生产环境请修改为随机字符串！
# 生成方式: openssl rand -hex 32
JWT_SECRET_KEY=cpu-dev-secret-key-change-in-production
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# ----------------------------------------------------------------------------
# CORS 配置
# ----------------------------------------------------------------------------
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:80

# ----------------------------------------------------------------------------
# CPU 加速器配置（核心差异）
# ----------------------------------------------------------------------------
# 加速器类型: cpu (不使用 GPU)
ACCELERATOR=cpu

# GPU 相关配置（CPU 模式全部留空或设为 0）
GPU_COUNT=0
CUDA_VISIBLE_DEVICES=
# CPU 模式下也需要至少 1 个 worker（在 CPU 设备上运行）
WORKER_GPUS=1

# Worker 批处理大小（CPU 模式降低批次大小）
MAX_BATCH_SIZE=1

# Worker 超时时间（秒，CPU 处理慢，延长超时）
WORKER_TIMEOUT=600

# Worker 内存限制（Mac 保守配置）
# 格式: 数字 + 单位（M/G），例如: 4G, 8G, 16G
# Mac 建议配置:
#   - 8GB Mac: 4G
#   - 16GB Mac: 8G
#   - 32GB+ Mac: 16G
WORKER_MEMORY_LIMIT=8G

# Worker 内存软限制（保证最少可用内存）
# 建议设置为硬限制的 50%
WORKER_MEMORY_RESERVATION=4G

# ----------------------------------------------------------------------------
# 文件配置
# ----------------------------------------------------------------------------
# 最大文件大小（字节，0 表示不限制）
MAX_FILE_SIZE=0

# Nginx 文件上传大小限制（0 表示不限制）
NGINX_CLIENT_MAX_BODY_SIZE=0

# ----------------------------------------------------------------------------
# PDF 拆分配置（大文件并行处理）
# ----------------------------------------------------------------------------
# 是否启用 PDF 自动拆分（true/false）
PDF_SPLIT_ENABLED=true

# PDF 拆分阈值（页数）
PDF_SPLIT_THRESHOLD_PAGES=500

# PDF 拆分块大小（页数）
PDF_SPLIT_CHUNK_SIZE=250

# ----------------------------------------------------------------------------
# 数据库配置
# ----------------------------------------------------------------------------
DATABASE_PATH=/app/data/db/mineru_tianshu.db

# ----------------------------------------------------------------------------
# 模型下载配置（CPU 本地开发环境）
# ----------------------------------------------------------------------------
# 模型下载源: local (离线模式，使用本地预下载的模型)
# 重要: 请先运行 python backend/download_models.py --output ./models-offline
MODEL_DOWNLOAD_SOURCE=local

# 离线模式标志（禁止 Hugging Face 联网下载）
HF_OFFLINE=1

# HuggingFace 镜像地址（国内加速，仅在非离线模式生效）
HF_ENDPOINT=https://hf-mirror.com

# HuggingFace Token（可选）
HF_TOKEN=

# 离线模型外部目录（主机路径，需包含预下载的所有模型文件）
OFFLINE_MODELS_PATH=./models-offline

# ----------------------------------------------------------------------------
# RustFS 对象存储配置
# ----------------------------------------------------------------------------
# 启用 RustFS（推荐）
RUSTFS_ENABLED=true

# RustFS 服务地址（容器内部）
RUSTFS_ENDPOINT=rustfs:9000

# RustFS 访问密钥（开发环境可使用默认值）
RUSTFS_ACCESS_KEY=rustfsadmin
RUSTFS_SECRET_KEY=rustfsadmin

# RustFS 存储桶名称
RUSTFS_BUCKET=ts-img

# RustFS 是否使用 HTTPS
RUSTFS_SECURE=false

# RustFS 公开访问 URL（外部访问地址）
#
# Mac 开发环境使用 host.docker.internal 访问宿主机服务
# 如果需要从局域网其他设备访问，请改为 Mac 的局域网 IP
# 例如: http://192.168.1.100:9000
#
RUSTFS_PUBLIC_URL=http://host.docker.internal:9000

# RustFS 服务端口
RUSTFS_PORT=9000
RUSTFS_CONSOLE_PORT=9001

# ----------------------------------------------------------------------------
# MCP Server 配置（可选）
# ----------------------------------------------------------------------------
API_URL=http://backend:8000

# ----------------------------------------------------------------------------
# Redis 队列配置（可选 - CPU 模式不建议启用）
# ----------------------------------------------------------------------------
# 是否启用 Redis 队列（CPU 模式建议保持 false）
REDIS_QUEUE_ENABLED=false

# Redis 服务器配置
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# ----------------------------------------------------------------------------
# 前端配置
# ----------------------------------------------------------------------------
VITE_API_BASE_URL=http://localhost:8000
